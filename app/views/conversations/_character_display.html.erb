<div class="md:h-full flex flex-col">
  <!-- Visual Novel Scene Area -->
  <div class="md:flex-1 relative bg-gradient-to-b from-slate-800 to-slate-900 flex flex-col">
    <!-- Scene Image Container -->
    <div class="md:flex-1 flex items-center justify-center relative min-h-[240px] p-4">
      <% scene_image = conversation.last_scene_image %>
      
      <% if scene_image %>
        <%= image_tag scene_image,
                      alt: "#{conversation.character.name} scene",
                      class: "max-w-full max-h-full object-contain rounded-xl shadow-2xl shadow-violet-500/10" %>
      <% else %>
        <!-- Initial Generation - Vertically Centered -->
        <div class="flex items-center justify-center">
          <div class="glass rounded-2xl p-8 text-center glow-violet">
            <div class="w-12 h-12 mx-auto mb-4 rounded-xl bg-gradient-to-br from-violet-500 to-indigo-600 flex items-center justify-center">
              <svg class="animate-spin w-6 h-6 text-white" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </div>
            <p class="text-sm text-slate-300">Generating scene...</p>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Updating Notification - Small Footnote -->
    <% if @conversation&.scene_generating %>
      <div class="text-center py-2">
        <div class="inline-flex items-center gap-2 px-3 py-1.5 glass rounded-full text-xs text-slate-400">
          <svg class="animate-spin w-3.5 h-3.5" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <span>Updating scene...</span>
        </div>
      </div>
    <% end %>

    <!-- Character Info Panel - Simplified -->
    <div class="glass border-t border-slate-700/50">
      <div class="max-w-sm mx-auto p-5 space-y-4">
        <div class="text-center">
          <h3 class="font-semibold text-lg text-white"><%= conversation.character.name %></h3>
          <p class="text-sm text-slate-400 flex items-center justify-center gap-1.5">
            <span class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></span>
            Active
          </p>
        </div>

        <!-- Character Tags - Centered -->
        <% if conversation.character.tag_list.any? %>
          <div class="flex flex-wrap justify-center gap-1.5">
            <% conversation.character.tag_list.first(3).each do |tag| %>
              <span class="px-2.5 py-1 bg-slate-700/50 text-slate-300 text-xs rounded-full border border-slate-600/50"><%= tag %></span>
            <% end %>
          </div>
        <% end %>

        <div class="flex flex-col items-center gap-3">
          <%= form_with model: conversation,
                        url: image_style_conversation_path(conversation),
                        method: :patch,
                        local: true,
                        class: "flex items-center gap-2" do |f| %>
            <%= f.label :image_style, "Style", class: "text-xs text-slate-400" %>
            <%= f.select :image_style,
                         options_for_select(@image_styles, @selected_image_style),
                         {},
                         class: "text-sm bg-slate-800/50 border border-slate-600/50 text-white rounded-lg px-3 py-1.5 focus:outline-none focus:ring-2 focus:ring-violet-500/50",
                         data: { controller: "autosubmit", action: "change->autosubmit#submit" } %>
          <% end %>

          <%= button_to regenerate_scene_conversation_path(conversation),
                        method: :post,
                        class: "inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-xl bg-gradient-to-r from-violet-600 to-indigo-600 hover:from-violet-500 hover:to-indigo-500 text-white shadow-lg shadow-violet-500/25 hover:shadow-violet-500/40 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed",
                        disabled: conversation.scene_generating || !conversation.user.venice_key_valid? do %>
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            Regenerate
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
